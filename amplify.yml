version: 1
backend:
  phases:
    build:
      commands:
        - echo "âš™ï¸ Construyendo backend con Amplify Gen 2..."
        # Amplify genera los outputs automÃ¡ticamente en /amplify_outputs.json
        - npx ampx pipeline-deploy --branch $AWS_BRANCH --app-id $AWS_APP_ID

frontend:
  phases:
    preBuild:
      commands:
        - echo "ğŸ“¦ Instalando dependencias..."
        - npm ci
        # Aseguramos que los outputs estÃ©n generados (por si el backend no cambiÃ³)
        - npx ampx generate outputs
    build:
      commands:
        - echo "ğŸ—ï¸ Compilando frontend con Vite..."
        - npm run build

  artifacts:
    baseDirectory: dist
    files:
      - '**/*'

  cache:
    paths:
      - node_modules/**/*
      - ~/.npm
